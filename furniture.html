<html>
  <head>
    <style>
      svg {
        border: 1px solid black;
      }
    </style>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <title>Arrange Your Furniture!</title>
  </head>
  <body>
    <script>
      $(document).ready(function() {
        var dataset = [];
        $("#addFurniture").hide();
        $('#roomSize').on('submit', function(e) {
          e.preventDefault();
          $('#roomSize').hide();
          $('#addFurniture').show();
          var room_width = $('input[name=width]').val();
          var room_length = $('input[name=length]').val();
          var a = (room_width < room_length) ? room_width : room_length;
          function dragmove(d) {
            d3.select(this).attr("y", function() {
              if (d3.event.y < 0) {
                return 0;
              } else if (d3.event.y > (scale(room_width) - this.getBBox().height)) {
                return scale(room_width) - this.getBBox().height;
              } else {
                return d3.event.y;
              }
            })
            .attr("x", function() {
              if (d3.event.x < 0) {
                return 0;
              } else if (d3.event.x > (scale(room_length) - this.getBBox().width)) {
                return scale(room_length) - this.getBBox().width;
              } else {
                return d3.event.x;
              }
            });
          }
          var drag = d3.behavior.drag().on("drag", dragmove);
          var scale = d3.scale.linear()
                        .domain([0, a])
                        .range([0, 400]);
          var svg = d3.select('body').append('svg').attr('width', scale(room_length)).attr('height', scale(room_width));
          $('#addFurniture').on('submit', function(e) {
          e.preventDefault();
          var name = $('input[name=name]').val();
          var width = $('input[name=furnWidth]').val();
          var length = $('input[name=furnLength]').val();
          dataset.push({name: name, width: width, length: length, x:0, y: 0});
          furniture(dataset);
        });
        function dragmove(d) {
          d3.select(this).attr("y", function() {
            if (d3.event.y < 0) {
              return 0;
            } else if (d3.event.y > (scale(room_width) - this.getBBox().height)) {
              return scale(room_width) - this.getBBox().height;
            } else {
              return d3.event.y;
            }
          })
          .attr("x", function() {
            if (d3.event.x < 0) {
              return 0;
            } else if (d3.event.x > (scale(room_length) - this.getBBox().width)) {
              return scale(room_length) - this.getBBox().width;
            } else {
              return d3.event.x;
            }
          });
        }
        var drag = d3.behavior.drag().on("drag", dragmove);
        function furniture(dataset) {  
          var r = svg.selectAll('rect').data(dataset).enter().append('rect');
          r.attr('x', function(d) {
            return scale(d.x);
          })
          .attr('y', function(d) {
            return scale(d.y);
          })
          .attr('width', function(d) {
            return scale(d.width);
          })
          .attr('height', function(d) {
            return scale(d.length);
          })
          .attr('fill', 'blue')
          .call(drag);
        }
        });
      });
    </script>
    <form id="roomSize">
      What size is your room?
      <br>Width: <input type="number" name="width">
      <br>Length: <input type="number" name="length">
      <br><input type="Submit" value="Submit">
    </form>
    <form id="addFurniture">
      Add a piece of furniture!<br>
      Name: <input type="text" name="name">
      <br>Width: <input type="number" name="furnWidth">
      <br>Length: <input type="number" name="furnLength">
      <br><input type="Submit" value="Submit">
    </form>
  </body>
</html>